(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{1884:function(e,t,r){Promise.resolve().then(r.bind(r,1553))},1553:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var s=r(7437),a=r(2265),l=r(9376),n=r(2141),i=r(4457),o=r.n(i),d=r(5865),c=r(3511);let x=(0,a.forwardRef)((e,t)=>{let{username:r}=e;return(0,s.jsxs)("div",{ref:t,className:"fixed left-[-9999px] top-0 w-[400px] h-[600px] bg-gradient-to-br from-red-50 via-white to-green-50 flex flex-col items-center text-center border-[12px] border-white rounded-[40px] overflow-hidden",style:{fontFamily:"system-ui, -apple-system, sans-serif",boxShadow:"0 20px 60px -10px rgba(0,0,0,0.1)"},children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 w-full h-full opacity-30 pointer-events-none mix-blend-multiply",style:{backgroundImage:"radial-gradient(#000 1px, transparent 1px)",backgroundSize:"20px 20px"}}),(0,s.jsxs)("div",{className:"relative z-10 w-full h-full flex flex-col justify-between items-center pt-16 pb-16",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center flex-1",children:[(0,s.jsx)("div",{className:"bg-white/60 backdrop-blur-md p-6 rounded-3xl border border-white shadow-sm mb-6 transform -rotate-2",children:(0,s.jsx)("span",{className:"text-7xl mb-2 block filter drop-shadow-md",children:"\uD83C\uDF81"})}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"inline-block px-5 py-2 bg-red-100 text-red-600 rounded-full text-lg font-bold mb-4 shadow-sm",children:"Happy Winter ❄️"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("h2",{className:"text-4xl font-black text-gray-900 leading-tight tracking-tight mb-3",children:[(0,s.jsx)("span",{className:"text-green-600",children:r}),"님의",(0,s.jsx)("br",{}),"선물함입니다"]}),(0,s.jsx)("p",{className:"text-gray-500 text-lg font-medium",children:"익명으로 마음을 전해주세요!"})]})]})]}),(0,s.jsx)("div",{className:"bg-white px-8 py-3 rounded-2xl shadow-md border border-gray-100 transform rotate-2",children:(0,s.jsx)("p",{className:"text-gray-400 font-mono text-base font-bold tracking-widest",children:"FromDear \uD83D\uDC8C"})})]})]})});function u(){let e=(0,l.useRouter)(),[t,r]=(0,a.useState)(null),[i,u]=(0,a.useState)([]),[m,h]=(0,a.useState)(!0),[b,f]=(0,a.useState)(""),[g,p]=(0,a.useState)(null),[w,j]=(0,a.useState)(!1),y=(0,a.useRef)(null),[v,N]=(0,a.useState)(!1),[k,D]=(0,a.useState)(null);(0,a.useEffect)(()=>{localStorage.getItem("has_seen_guide")||j(!0)},[]),(0,a.useEffect)(()=>{(async()=>{let{data:{session:t}}=await n.O.auth.getSession();if(!t){e.push("/auth");return}let{data:s}=await n.O.from("users").select("*").eq("id",t.user.id).single();if(!s){e.push("/onboarding");return}r(s);let{data:a}=await n.O.from("messages").select("*").eq("user_id",t.user.id).order("created_at",{ascending:!1});a&&u(a),h(!1)})()},[e]);let C=()=>{if(!t||!t.link_id)return;let e="".concat(window.location.origin,"/box?id=").concat(t.link_id);navigator.clipboard.writeText(e),f("링크가 복사되었습니다!"),setTimeout(()=>f(""),2e3)},S=async()=>{if(y.current&&!v){N(!0),D(null);try{(await o()(y.current,{scale:2,backgroundColor:null,logging:!1,useCORS:!0,allowTaint:!0})).toBlob(async e=>{if(!e){alert("이미지 생성 실패: Blob is null"),N(!1);return}try{let t=new ClipboardItem({"image/png":e});await navigator.clipboard.write([t]),confirm("✅ 이미지가 복사되었습니다!\n\n인스타그램을 열어 붙여넣기 하시겠습니까?")&&(window.location.href="instagram://story-camera"),N(!1)}catch(r){console.error("Clipboard failed:",r);let t=URL.createObjectURL(e);D(t),N(!1)}},"image/png")}catch(e){console.error("Share failed:",e),alert("오류가 발생했습니다: ".concat(e.message)),N(!1)}}},I=async e=>{p(e),e.is_opened||(await n.O.from("messages").update({is_opened:!0}).eq("id",e.id),u(t=>t.map(t=>t.id===e.id?{...t,is_opened:!0}:t)))};return m?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-red-50",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("main",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-green-50 py-10 px-4 overflow-hidden relative",children:[(0,s.jsx)(d.Z,{}),(0,s.jsxs)("div",{className:"max-w-5xl mx-auto relative z-10",children:[(0,s.jsxs)("header",{className:"flex flex-col md:flex-row justify-between items-center mb-10 gap-6",children:[(0,s.jsxs)("div",{className:"text-center md:text-left",children:[(0,s.jsx)("div",{className:"inline-block px-3 py-1 bg-red-100 text-red-600 rounded-full text-xs font-bold mb-2",children:"Happy Winter ❄️"}),(0,s.jsxs)("h1",{className:"text-3xl md:text-4xl font-black text-gray-900",children:[null==t?void 0:t.username,"님의 선물함 \uD83C\uDF81"]}),(0,s.jsxs)("p",{className:"text-gray-500 mt-2 font-medium",children:["지금까지 ",(0,s.jsx)("span",{className:"text-red-600 font-bold",children:i.length}),"개의 마음을 받았어요!"]})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[(0,s.jsx)("button",{onClick:C,className:"flex-1 md:flex-none px-6 py-3 bg-white text-gray-700 border border-gray-200 rounded-xl font-bold hover:bg-gray-50 hover:border-gray-300 transition-all shadow-sm flex items-center justify-center gap-2",children:b?"✅ 복사 완료!":"\uD83D\uDD17 내 선물함 링크 복사"}),(0,s.jsx)("button",{onClick:async()=>{await n.O.auth.signOut(),e.push("/")},className:"px-6 py-3 text-gray-500 hover:text-red-600 font-medium transition-colors",children:"로그아웃"})]})]}),(0,s.jsx)(x,{ref:y,username:(null==t?void 0:t.username)||""}),(0,s.jsx)("div",{className:"mb-10 flex flex-col sm:flex-row gap-3 justify-center md:justify-start",children:(0,s.jsx)("button",{onClick:S,className:"px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-2xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all flex items-center justify-center gap-2",children:v?"생성 중... \uD83C\uDFA8":"\uD83D\uDCF8 인스타 스토리에 공유하기"})}),(0,s.jsx)("div",{className:"bg-white/40 backdrop-blur-md rounded-[2.5rem] p-6 md:p-12 shadow-2xl border border-white/60 min-h-[500px]",children:0===i.length?(0,s.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-center py-32",children:[(0,s.jsx)("div",{className:"text-7xl mb-6 opacity-30 animate-bounce",children:"\uD83C\uDF81"}),(0,s.jsx)("h3",{className:"text-2xl font-bold text-gray-700 mb-2",children:"아직 도착한 선물이 없어요"}),(0,s.jsx)("p",{className:"text-gray-500 mb-8",children:"친구들에게 링크를 공유해보세요!"}),(0,s.jsxs)("div",{className:"flex flex-col gap-3 w-full max-w-sm",children:[(0,s.jsx)("button",{onClick:C,className:"px-8 py-4 bg-red-600 text-white font-bold rounded-2xl shadow-lg hover:bg-red-700 hover:-translate-y-1 transition-all",children:"링크 공유하고 선물 받기 \uD83D\uDCEE"}),(0,s.jsx)("button",{onClick:()=>j(!0),className:"px-8 py-3 bg-white text-gray-600 font-bold rounded-2xl border border-gray-200 hover:bg-gray-50 transition-all text-sm",children:"❓ 어떻게 하는 건가요?"})]})]}):(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:i.map((e,t)=>(0,s.jsxs)("div",{onClick:()=>I(e),className:"\n                                            aspect-square rounded-3xl p-4 md:p-6 shadow-lg relative overflow-hidden group cursor-pointer transition-all duration-300 flex flex-col items-center justify-center\n                                            ".concat(e.is_opened?"bg-white":"bg-red-50 border-2 border-red-100","\n                                            hover:-translate-y-2 hover:shadow-2xl\n                                        "),children:[(0,s.jsx)("span",{className:"text-6xl md:text-7xl mb-4 md:mb-5 transform group-hover:scale-110 transition-transform duration-300",children:e.is_opened?"\uD83E\uDDF8":"\uD83C\uDF81"}),(0,s.jsx)("span",{className:"text-sm md:text-base font-bold px-3 py-1 rounded-full truncate max-w-[90%] ".concat(e.is_opened?"bg-gray-100 text-gray-500":"bg-red-100 text-red-600"),children:e.sender_name||"익명"}),!e.is_opened&&(0,s.jsx)("div",{className:"absolute top-4 right-4 w-3 h-3 bg-red-600 rounded-full animate-ping"})]},e.id))})}),(0,s.jsxs)("div",{className:"mt-10 text-center",children:[(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:"친구들에게 링크를 공유하고 더 많은 메시지를 받아보세요!"}),(0,s.jsxs)("div",{className:"inline-block bg-white px-4 py-2 rounded-lg border border-gray-200 text-gray-500 text-sm",children:[window.location.origin,"/box?id=",null==t?void 0:t.link_id]})]})]}),g&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:()=>p(null),children:(0,s.jsxs)("div",{className:"bg-white rounded-3xl w-full max-w-lg p-8 shadow-2xl transform transition-all scale-100 relative translate-y-0",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{onClick:()=>p(null),className:"absolute top-6 right-6 text-gray-300 hover:text-gray-500 transition-colors",children:(0,s.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsxs)("div",{className:"text-center mb-8 pt-4",children:[(0,s.jsx)("div",{className:"text-5xl mb-6",children:"\uD83C\uDF84"}),(0,s.jsxs)("h3",{className:"text-2xl font-bold text-gray-900 leading-tight",children:[(0,s.jsx)("span",{className:"text-red-600",children:g.sender_name||"익명"}),"님이 보낸",(0,s.jsx)("br",{}),"마음의 선물입니다"]}),(0,s.jsx)("p",{className:"text-gray-400 text-sm mt-3 font-medium",children:new Date(g.created_at).toLocaleString()})]}),g.emotion_analysis&&(0,s.jsxs)("div",{className:"mx-auto mb-6 bg-white border-2 border-dashed border-gray-300 p-4 rounded-lg w-full max-w-xs relative rotate-1 shadow-sm",children:[(0,s.jsx)("div",{className:"absolute -top-2 left-1/2 transform -translate-x-1/2 bg-white px-2 text-xs font-bold text-gray-400 tracking-widest",children:"INGREDIENTS"}),(0,s.jsx)("h4",{className:"text-center font-bold text-gray-700 mb-3 border-b pb-2 text-sm",children:"선물 성분표 \uD83E\uDDFE"}),(0,s.jsx)("div",{className:"space-y-2",children:Object.entries(g.emotion_analysis).map(e=>{let[t,r]=e;return(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"font-medium text-gray-600",children:t}),(0,s.jsx)("div",{className:"flex-1 mx-3 h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-red-400 rounded-full",style:{width:"".concat(r,"%")}})}),(0,s.jsxs)("span",{className:"font-mono font-bold text-gray-800",children:[r,"%"]})]},t)})}),(0,s.jsx)("div",{className:"mt-3 pt-2 border-t border-dashed border-gray-300 text-center text-xs text-gray-400 font-mono",children:"100% SINCERITY INCLUDED"})]}),(0,s.jsx)("div",{className:"bg-[#FFFDF5] p-8 rounded-2xl text-gray-700 leading-relaxed whitespace-pre-wrap max-h-[50vh] overflow-y-auto mb-8 text-lg border border-red-50 shadow-inner",children:g.content}),(0,s.jsx)("div",{className:"flex gap-3",children:(0,s.jsx)("button",{onClick:()=>p(null),className:"flex-1 py-4 bg-gray-100 text-gray-700 font-bold rounded-2xl hover:bg-gray-200 transition-colors",children:"닫기"})})]})}),k&&(0,s.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",onClick:()=>D(null),children:(0,s.jsxs)("div",{className:"bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl relative",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{onClick:()=>D(null),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"이미지 저장/복사하기"}),(0,s.jsxs)("p",{className:"text-gray-500 text-sm text-center mb-4",children:["자동 복사가 지원되지 않는 브라우저입니다.",(0,s.jsx)("br",{}),(0,s.jsx)("b",{children:"이미지를 꾹 눌러서 복사 또는 저장"})," 후",(0,s.jsx)("br",{}),"인스타그램에 올려주세요!"]}),(0,s.jsx)("div",{className:"rounded-xl overflow-hidden border border-gray-200 shadow-inner bg-gray-50 mb-6",children:(0,s.jsx)("img",{src:k,alt:"Sticker",className:"w-full h-auto"})}),(0,s.jsx)("button",{onClick:()=>{window.location.href="instagram://story-camera"},className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2",children:"\uD83D\uDCF8 인스타그램 열기"})]})})]}),(0,s.jsx)(c.Z,{isOpen:w,onClose:()=>j(!1)})]})}x.displayName="ShareSticker"},3511:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var s=r(7437),a=r(2265);function l(e){let{isOpen:t,onClose:r}=e,[l,n]=(0,a.useState)(0),i=[{emoji:"\uD83C\uDF81",title:"3초 만에 선물함 만들기",desc:"복잡한 절차는 없어요! 로그인 한 번이면\n나만의 특별한 선물함이 즉시 만들어집니다.",color:"bg-red-50 text-red-600"},{emoji:"\uD83D\uDD17",title:"링크 복사해서 자랑하기",desc:"내 선물함 주소를 복사해서\n인스타그램 스토리나 카톡 프로필에 올려주세요.\n'나한테도 써줘!'라고 적어보면 어떨까요?",color:"bg-green-50 text-green-600"},{emoji:"\uD83D\uDC8C",title:"익명 편지 열어보기",desc:"친구들의 속마음이 익명으로 도착해요.\n누가 보냈을지 상상하며 하나씩 열어보세요.\n도착한 마음들은 평생 간직할 수 있어요.",color:"bg-yellow-50 text-yellow-600"}];(0,a.useEffect)(()=>{t&&n(0)},[t]);let o=()=>{localStorage.setItem("has_seen_guide","true"),r()};return t?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:o,children:(0,s.jsxs)("div",{className:"bg-white rounded-3xl w-full max-w-sm p-8 shadow-2xl relative overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{onClick:o,className:"absolute top-4 right-4 text-gray-300 hover:text-gray-500 transition-colors p-2",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsxs)("div",{className:"text-center mt-4",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-8",children:"FromDear 200% 즐기기 ❄️"}),(0,s.jsx)("div",{className:"relative min-h-[220px]",children:i.map((e,t)=>(0,s.jsxs)("div",{className:"absolute inset-0 transition-all duration-500 transform ".concat(t===l?"opacity-100 translate-x-0 scale-100":t<l?"opacity-0 -translate-x-full scale-90":"opacity-0 translate-x-full scale-90"),children:[(0,s.jsx)("div",{className:"w-24 h-24 mx-auto ".concat(e.color," rounded-full flex items-center justify-center text-5xl mb-6 shadow-sm"),children:e.emoji}),(0,s.jsx)("h4",{className:"text-lg font-bold text-gray-800 mb-3",children:e.title}),(0,s.jsx)("p",{className:"text-gray-500 leading-relaxed whitespace-pre-wrap",children:e.desc})]},t))}),(0,s.jsx)("div",{className:"flex justify-center gap-2 mb-8 mt-10",children:i.map((e,t)=>(0,s.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat(t===l?"w-8 bg-red-500":"w-2 bg-gray-200")},t))}),(0,s.jsx)("button",{onClick:()=>{l<i.length-1?n(l+1):o()},className:"w-full py-4 bg-gray-900 text-white font-bold rounded-2xl hover:bg-black transition-all shadow-lg active:scale-95",children:l<i.length-1?"다음 >":"시작하기!"})]})]})}):null}},5865:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var s=r(7437),a=r(2265);function l(){let e=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let t=e.current;if(!t)return;let r=t.getContext("2d");if(!r)return;let s=window.innerWidth,a=window.innerHeight;t.width=s,t.height=a;let l=[];for(let e=0;e<50;e++)l.push({x:Math.random()*s,y:Math.random()*a,radius:3*Math.random()+1,speed:1*Math.random()+.5,opacity:.5*Math.random()+.3});!function e(){r&&t&&(r.clearRect(0,0,t.width,t.height),r.fillStyle="white",l.forEach(e=>{r.beginPath(),r.arc(e.x,e.y,e.radius,0,2*Math.PI),r.fillStyle="rgba(255, 255, 255, ".concat(e.opacity,")"),r.fill(),e.y+=e.speed,e.x+=.5*Math.sin(e.y/50),e.y>t.height&&(e.y=-10,e.x=Math.random()*t.width)}),requestAnimationFrame(e))}();let n=()=>{t&&(t.width=window.innerWidth,t.height=window.innerHeight)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),(0,s.jsx)("canvas",{ref:e,className:"fixed inset-0 pointer-events-none z-50",style:{width:"100%",height:"100%"}})}},2141:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});var s=r(338);let a="https://vlydnlmwwhofsksikaeh.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZseWRubG13d2hvZnNrc2lrYWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3ODQ0NzEsImV4cCI6MjA3ODM2MDQ3MX0.XA5pvZRRAVd5h3q1g4iJ0Muibadb1gIKbSBnuW9lu78";a&&l||console.warn("Supabase environment variables are not set");let n=(0,s.createBrowserClient)(a,l)},9376:function(e,t,r){"use strict";var s=r(5475);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[337,338,971,117,744],function(){return e(e.s=1884)}),_N_E=e.O()}]);