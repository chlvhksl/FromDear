(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[977],{108:function(e,t,r){Promise.resolve().then(r.bind(r,8923))},8923:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var s=r(7437),n=r(2265),a=r(9376),l=r(2141),o=r(7648);function i(){(0,a.useRouter)();let e=(0,a.useSearchParams)().get("id"),[t,r]=(0,n.useState)(""),[i,c]=(0,n.useState)(""),[u,d]=(0,n.useState)(!1),[h,m]=(0,n.useState)(null),[x,f]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e&&(async()=>{let{data:t}=await l.O.from("users").select("*").eq("link_id",e).single();t&&m(t)})()},[e]);let b=e=>{let t={"사랑 ❤️":["사랑","love","러브","좋아","하트","heart","아껴","소중","평생","영원","내꺼","예뻐","멋져","쪽","알라뷰"],"감동 \uD83E\uDD79":["고마","감사","땡큐","thanks","덕분","감동","눈물","울컥","찐심","진심","잊지"],"응원 \uD83D\uDCAA":["화이팅","파이팅","힘내","응원","할수있어","믿어","대박","가즈아","성공","합격","잘될","포기하지마"],"축하 \uD83C\uDF89":["축하","메리","해피","happy","merry","겨울","winter","크리스마스","성탄","산타","선물","파티","종강","방학","새해"],"설렘 \uD83D\uDC93":["기대","두근","설레","보고싶","만나","데이트","준비","떨려","빨리","기다려"],"위로 ☕️":["수고","고생","괜찮","토닥","따뜻","건강","감기","조심","밥","휴식","힐링","걱정마"],"유머 ㅋ":["ㅋㅋ","ㅎㅎ","빵터","재미","웃겨","센스","꿀잼","장난","드립"]},r={};for(let e of Object.keys(t))r[e]=0;for(let[s,n]of Object.entries(t))for(let t of n)e.includes(t)&&(r[s]+=15);0===Object.values(r).reduce((e,t)=>e+t,0)&&(r["따뜻한 마음 \uD83D\uDD25"]=50);let s=["크리스마스 마법 \uD83E\uDE84","눈오는 날의 추억 ☃️","100% 진심 \uD83D\uDC9D","붕어빵의 온기 \uD83E\uDD56","새해 복 \uD83E\uDDE7","산타의 실수 \uD83C\uDF85"];r[s[Math.floor(Math.random()*s.length)]]=10;let n=Object.entries(r).filter(e=>{let[t,r]=e;return r>0}).sort((e,t)=>t[1]-e[1]).map(e=>{let[t,r]=e;return[t,r+Math.floor(5*Math.random())]}).slice(0,4),a=n.reduce((e,t)=>{let[r,s]=t;return e+s},0),l={};if(a>0){let e=0;n.forEach((t,r)=>{let[s,o]=t,i=r===n.length-1?100-e:Math.round(o/a*100);l[s]=i,e+=i})}else l["따뜻한 마음 \uD83D\uDD25"]=100;return l},g=async e=>{if(e.preventDefault(),h&&!u){d(!0);try{let e=null;try{let r=new AbortController,s=setTimeout(()=>r.abort(),3e3),n=await fetch("https://vlydnlmwwhofsksikaeh.supabase.co/functions/v1/analyze-emotion",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZseWRubG13d2hvZnNrc2lrYWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3ODQ0NzEsImV4cCI6MjA3ODM2MDQ3MX0.XA5pvZRRAVd5h3q1g4iJ0Muibadb1gIKbSBnuW9lu78")},body:JSON.stringify({message:t}),signal:r.signal});if(clearTimeout(s),n.ok)e=await n.json();else throw Error("API failed")}catch(r){console.warn("AI Analysis failed, using enhanced local analysis",r),e=b(t)}e&&0!==Object.keys(e).length||(e=b(t));let{error:r}=await l.O.from("messages").insert({user_id:h.id,content:t,sender_name:i||"익명",is_opened:!1,emotion_analysis:e});if(r)throw r;f(!0)}catch(e){console.error("Message Send Error:",e),alert("선물 전송에 실패했어요 \uD83D\uDE22\n오류 내용: ".concat(e.message||JSON.stringify(e)))}finally{d(!1)}}};return h?x?(0,s.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-green-50 py-10 px-4 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-10 border-2 border-green-100 text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-6 animate-bounce",children:"\uD83C\uDF81"}),(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:"선물 배달 완료!"}),(0,s.jsxs)("p",{className:"text-gray-600 mb-8 text-lg",children:[h.username,"님에게 마음을",(0,s.jsx)("br",{}),"성공적으로 전달했어요."]}),(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)("button",{onClick:()=>window.location.href="/box?id=".concat(e),className:"w-full py-4 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition-colors shadow-lg hover:shadow-xl transform hover:-translate-y-1",children:"친구 선물함으로 돌아가기"}),(0,s.jsx)("button",{onClick:()=>window.location.href="/",className:"w-full py-4 bg-red-600 text-white font-bold rounded-xl hover:bg-red-700 transition-colors shadow-lg hover:shadow-xl transform hover:-translate-y-1",children:"나도 선물함 만들기 \uD83C\uDF81"})]})]})}):(0,s.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-green-50 py-10 px-4",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto bg-white rounded-2xl shadow-xl p-8 border-2 border-red-100",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold text-gray-800",children:[h.username,"님에게 마음 선물하기 \uD83C\uDF81"]}),(0,s.jsxs)("p",{className:"text-gray-500 mt-2 text-sm",children:["따뜻한 겨울 인사를 남겨주세요.",(0,s.jsx)("br",{}),"친구에게 바로 배달됩니다."]})]}),(0,s.jsxs)("form",{onSubmit:g,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"보내는 사람 (선택)"}),(0,s.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"익명 (비워두면 익명으로 전달돼요)",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition-all",maxLength:20})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"메시지 내용"}),(0,s.jsx)("textarea",{value:t,onChange:e=>r(e.target.value),required:!0,placeholder:"여기에 소중한 마음을 담아주세요...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition-all h-40 resize-none",maxLength:500}),(0,s.jsxs)("div",{className:"text-right text-xs text-gray-400 mt-1",children:[t.length,"/500"]})]}),(0,s.jsx)("button",{type:"submit",disabled:u,className:"w-full py-3 bg-gradient-to-r from-red-500 to-green-500 text-white font-bold rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all disabled:opacity-50",children:u?"선물 포장 중... \uD83C\uDF81":"선물 보내기 \uD83C\uDF81"})]}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsx)(o.default,{href:"/box?id=".concat(e),className:"text-sm text-gray-500 hover:text-gray-700",children:"취소하고 돌아가기"})})]})}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"로딩 중..."})}function c(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"로딩 중..."}),children:(0,s.jsx)(i,{})})}},2141:function(e,t,r){"use strict";r.d(t,{O:function(){return l}});var s=r(338);let n="https://vlydnlmwwhofsksikaeh.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZseWRubG13d2hvZnNrc2lrYWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3ODQ0NzEsImV4cCI6MjA3ODM2MDQ3MX0.XA5pvZRRAVd5h3q1g4iJ0Muibadb1gIKbSBnuW9lu78";n&&a||console.warn("Supabase environment variables are not set");let l=(0,s.createBrowserClient)(n,a)},9376:function(e,t,r){"use strict";var s=r(5475);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[338,648,971,117,744],function(){return e(e.s=108)}),_N_E=e.O()}]);